<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portal â€” æ¶æ„å›¾é›†</title>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
  <style>
    :root {
      --bg: #0f1117;
      --surface: #1a1d2e;
      --text: #e2e8f0;
      --text-secondary: #94a3b8;
      --accent: #6366f1;
      --border: #2d3148;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.7;
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, #6366f1, #a78bfa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    h1 + p { color: var(--text-secondary); margin-bottom: 2.5rem; }
    h2 {
      font-size: 1.4rem;
      margin: 2.5rem 0 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border);
    }
    h2 span { color: var(--accent); margin-right: 0.5rem; }
    .diagram-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2rem;
      overflow-x: auto;
    }
    .diagram-card .mermaid {
      display: flex;
      justify-content: center;
    }
    .note {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-top: 0.75rem;
      padding-left: 1rem;
      border-left: 3px solid var(--accent);
    }
    nav {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }
    nav ul { list-style: none; display: flex; flex-wrap: wrap; gap: 0.5rem 1.5rem; }
    nav a {
      color: var(--accent);
      text-decoration: none;
      font-size: 0.9rem;
    }
    nav a:hover { text-decoration: underline; }
  </style>
</head>
<body>

<h1>Portal â€” æ¶æ„å›¾é›†</h1>
<p>æœ¬æ–‡ä»¶ä½¿ç”¨ Mermaid.js æ¸²æŸ“ï¼Œè¯·åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æŸ¥çœ‹æ‰€æœ‰æ¶æ„å›¾ã€‚</p>

<nav>
  <ul>
    <li><a href="#system-arch">ç³»ç»Ÿæ¶æ„</a></li>
    <li><a href="#module-arch">æ¨¡å—åŒ–æ¶æ„</a></li>
    <li><a href="#theme-arch">ä¸»é¢˜ç³»ç»Ÿ</a></li>
    <li><a href="#admin-arch">ç®¡ç†åå°</a></li>
    <li><a href="#data-model">æ•°æ®æ¨¡å‹</a></li>
    <li><a href="#deploy-flow">éƒ¨ç½²æµç¨‹</a></li>
    <li><a href="#impl-gantt">å®ç°è·¯çº¿å›¾</a></li>
  </ul>
</nav>

<!-- ==================== 1. ç³»ç»Ÿæ¶æ„ ==================== -->
<h2 id="system-arch"><span>1</span>ç³»ç»Ÿæ¶æ„æ€»è§ˆ</h2>
<div class="diagram-card">
<pre class="mermaid">
graph TB
    subgraph Frontend["å‰ç«¯ (Next.js 15)"]
        A["ä¸»é¢˜å¼•æ“<br/>ThemeProvider"] --> B["æ¨¡å—åŠ è½½å™¨<br/>Module Loader"]
        B --> C["åŠŸèƒ½æ¨¡å—<br/>Feature Modules"]
        B --> D["å¸ƒå±€ç³»ç»Ÿ<br/>Layout System"]
        C --> E["é¡µé¢è·¯ç”±<br/>App Router"]
    end

    subgraph Admin["ç®¡ç†åå° (Admin)"]
        F["ä»ªè¡¨ç›˜<br/>Dashboard"] --> G["å†…å®¹ç®¡ç†<br/>CMS"]
        F --> H["ä¸»é¢˜/æ¨¡å—é…ç½®<br/>Config Manager"]
        F --> I["ç›‘æ§é¢æ¿<br/>Monitoring"]
        F --> J["ç”¨æˆ·ç®¡ç†<br/>User Mgmt"]
    end

    subgraph Backend["åç«¯ (tRPC + Next.js API)"]
        K["tRPC Router"] --> L["è®¤è¯æœåŠ¡<br/>Auth Service"]
        K --> M["å†…å®¹æœåŠ¡<br/>Content Service"]
        K --> N["é…ç½®æœåŠ¡<br/>Config Service"]
        K --> O["åˆ†ææœåŠ¡<br/>Analytics Service"]
        K --> P["åª’ä½“æœåŠ¡<br/>Media Service"]
    end

    subgraph Data["æ•°æ®å±‚"]
        Q[("PostgreSQL<br/>ä¸»æ•°æ®åº“")]
        R[("Redis<br/>ç¼“å­˜/é™æµ")]
        S[("S3/R2<br/>å¯¹è±¡å­˜å‚¨")]
        T[("MeiliSearch<br/>æœç´¢å¼•æ“")]
    end

    E --> K
    F --> K
    L & M & N & O & P --> Q
    L & M & N --> R
    P --> S
    M --> T

    style Frontend fill:#1e293b,stroke:#6366f1,color:#e2e8f0
    style Admin fill:#1e293b,stroke:#a78bfa,color:#e2e8f0
    style Backend fill:#1e293b,stroke:#22d3ee,color:#e2e8f0
    style Data fill:#1e293b,stroke:#f59e0b,color:#e2e8f0
</pre>
</div>
<p class="note">å…¨æ ˆ TypeScript æ¶æ„ï¼šNext.js 15 æ‰¿è½½å‰ç«¯ + API å±‚ï¼ŒtRPC å®ç°ç«¯åˆ°ç«¯ç±»å‹å®‰å…¨ã€‚</p>

<!-- ==================== 2. æ¨¡å—åŒ–æ¶æ„ ==================== -->
<h2 id="module-arch"><span>2</span>æ¨¡å—åŒ–æ¶æ„</h2>
<div class="diagram-card">
<pre class="mermaid">
graph LR
    subgraph Core["æ ¸å¿ƒå±‚ (å§‹ç»ˆå¯ç”¨)"]
        CORE["æ ¸å¿ƒæ¡†æ¶"] --> THEME["ğŸ¨ ä¸»é¢˜ç³»ç»Ÿ"]
        CORE --> AUTH["ğŸ” è®¤è¯ç³»ç»Ÿ"]
        CORE --> ROUTER["ğŸ”€ è·¯ç”±ç³»ç»Ÿ"]
        CORE --> I18N["ğŸŒ å›½é™…åŒ–"]
        CORE --> SEO["ğŸ“ˆ SEO å¼•æ“"]
    end

    subgraph Modules["å¯é€‰åŠŸèƒ½æ¨¡å—"]
        MOD_BLOG["ğŸ“ åšå®¢"]
        MOD_PORTFOLIO["ğŸ¨ ä½œå“é›†"]
        MOD_RESUME["ğŸ“„ ç®€å†"]
        MOD_GALLERY["ğŸ–¼ï¸ å›¾åº“"]
        MOD_GUESTBOOK["ğŸ’¬ ç•™è¨€æ¿"]
        MOD_LINKS["ğŸ”— å‹é“¾"]
        MOD_ABOUT["ğŸ‘¤ å…³äºæˆ‘"]
        MOD_TOOLS["ğŸ› ï¸ å·¥å…·ç®±"]
        MOD_ANALYTICS["ğŸ“Š æ•°æ®ç»Ÿè®¡"]
        MOD_SEARCH["ğŸ” å…¨ç«™æœç´¢"]
    end

    CORE --> MOD_BLOG
    CORE --> MOD_PORTFOLIO
    CORE --> MOD_RESUME
    CORE --> MOD_GALLERY
    CORE --> MOD_GUESTBOOK
    CORE --> MOD_LINKS
    CORE --> MOD_ABOUT
    CORE --> MOD_TOOLS
    CORE --> MOD_ANALYTICS
    CORE --> MOD_SEARCH

    style Core fill:#1e293b,stroke:#6366f1,color:#e2e8f0
    style Modules fill:#1e293b,stroke:#22d3ee,color:#e2e8f0
</pre>
</div>

<!-- ==================== 3. ä¸»é¢˜ç³»ç»Ÿ ==================== -->
<h2 id="theme-arch"><span>3</span>ä¸»é¢˜ç³»ç»Ÿæ¶æ„</h2>
<div class="diagram-card">
<pre class="mermaid">
graph TD
    A["ä¸»é¢˜é…ç½®æ–‡ä»¶<br/>theme.config.ts"] --> B["ä¸»é¢˜å¼•æ“<br/>ThemeProvider"]
    B --> C["CSS å˜é‡æ³¨å…¥<br/>:root { --color-primary: ... }"]
    B --> D["ç»„ä»¶çº§å˜ä½“<br/>Tailwind dark: / theme-*"]
    C --> E["å…¨å±€æ ·å¼"]
    D --> F["æ¨¡å—æ ·å¼é€‚é…"]

    G["ç”¨æˆ·åå¥½<br/>localStorage"] --> B
    H["ç³»ç»Ÿåå¥½<br/>prefers-color-scheme"] --> B

    I["æç®€ç™½"] --> A
    J["æš—å¤œé»‘"] --> A
    K["èµ›åšæœ‹å…‹"] --> A
    L["è‡ªç„¶ç»¿"] --> A
    M["å¤å¤æ£•"] --> A

    style B fill:#6366f1,stroke:#818cf8,color:#fff
</pre>
</div>

<!-- ==================== 4. ç®¡ç†åå° ==================== -->
<h2 id="admin-arch"><span>4</span>ç®¡ç†åå°åŠŸèƒ½ç»“æ„</h2>
<div class="diagram-card">
<pre class="mermaid">
graph TB
    subgraph AdminDashboard["ç®¡ç†åå°"]
        A["ğŸ“Š ä»ªè¡¨ç›˜"]
        B["ğŸ“ å†…å®¹ç®¡ç†"]
        C["ğŸ¨ å¤–è§‚é…ç½®"]
        D["âš™ï¸ æ¨¡å—ç®¡ç†"]
        E["ğŸ‘¥ ç”¨æˆ·ç®¡ç†"]
        F["ğŸ“ˆ æ•°æ®åˆ†æ"]
        G["ğŸ”§ ç³»ç»Ÿè®¾ç½®"]
    end

    A --> A1["å®æ—¶è®¿é—®é‡"]
    A --> A2["ç³»ç»ŸçŠ¶æ€"]
    A --> A3["è¿‘æœŸæ´»åŠ¨"]
    A --> A4["å¿«æ·æ“ä½œ"]

    B --> B1["æ–‡ç« ç®¡ç†"]
    B --> B2["é¡¹ç›®ç®¡ç†"]
    B --> B3["åª’ä½“åº“"]
    B --> B4["è¯„è®ºç®¡ç†"]

    C --> C1["ä¸»é¢˜åˆ‡æ¢"]
    C --> C2["å¸ƒå±€é…ç½®"]
    C --> C3["å¯¼èˆªèœå•"]
    C --> C4["è‡ªå®šä¹‰ CSS"]

    D --> D1["æ¨¡å—å¯ç”¨/ç¦ç”¨"]
    D --> D2["é¢„è®¾ç»„åˆ"]
    D --> D3["æ¨¡å—é…ç½®"]

    F --> F1["è®¿é—®ç»Ÿè®¡"]
    F --> F2["æ¥æºåˆ†æ"]
    F --> F3["çƒ­é—¨å†…å®¹"]
    F --> F4["æ€§èƒ½ç›‘æ§"]

    style AdminDashboard fill:#1e293b,stroke:#a78bfa,color:#e2e8f0
</pre>
</div>

<!-- ==================== 5. æ•°æ®æ¨¡å‹ ==================== -->
<h2 id="data-model"><span>5</span>æ•°æ®æ¨¡å‹ (ER å›¾)</h2>
<div class="diagram-card">
<pre class="mermaid">
erDiagram
    User {
        string id PK
        string email
        string name
        string role
        datetime createdAt
    }

    Post {
        string id PK
        string title
        string slug
        string content
        string status
        string categoryId FK
        string authorId FK
        datetime publishedAt
    }

    Tag {
        string id PK
        string name
        string slug
    }

    PostTag {
        string postId FK
        string tagId FK
    }

    Category {
        string id PK
        string name
        string slug
    }

    Project {
        string id PK
        string title
        string description
        string coverImage
        string liveUrl
        string repoUrl
        int sortOrder
    }

    ProjectTech {
        string projectId FK
        string techName
    }

    Media {
        string id PK
        string url
        string type
        int size
        string alt
        datetime uploadedAt
    }

    Comment {
        string id PK
        string content
        string authorName
        string authorEmail
        string postId FK
        string parentId FK
        string status
        datetime createdAt
    }

    GuestbookEntry {
        string id PK
        string content
        string authorName
        string avatar
        datetime createdAt
    }

    Link {
        string id PK
        string name
        string url
        string avatar
        string description
        string category
        boolean isAlive
    }

    PageView {
        string id PK
        string path
        string referrer
        string userAgent
        string country
        datetime timestamp
    }

    SiteConfig {
        string id PK
        string key
        json value
    }

    User ||--o{ Post : "writes"
    Category ||--o{ Post : "contains"
    Post ||--o{ Comment : "has"
    Post ||--o{ PostTag : "tagged"
    Tag ||--o{ PostTag : "used in"
    Comment ||--o{ Comment : "replies to"
    Project ||--o{ ProjectTech : "uses"
</pre>
</div>

<!-- ==================== 6. éƒ¨ç½²æµç¨‹ ==================== -->
<h2 id="deploy-flow"><span>6</span>CI/CD ä¸éƒ¨ç½²æµç¨‹</h2>
<div class="diagram-card">
<pre class="mermaid">
graph LR
    A["ğŸ§‘â€ğŸ’» æœ¬åœ°å¼€å‘"] -->|"git push"| B["GitHub"]
    B -->|"Webhook"| C["GitHub Actions"]
    C --> D{"åˆ†æ”¯åˆ¤æ–­"}
    D -->|"main"| E["ğŸš€ ç”Ÿäº§éƒ¨ç½²<br/>Vercel Production"]
    D -->|"feature/*"| F["ğŸ‘€ é¢„è§ˆéƒ¨ç½²<br/>Vercel Preview"]

    C --> G["è‡ªåŠ¨åŒ–æ£€æŸ¥"]
    G --> G1["âœ… ç±»å‹æ£€æŸ¥<br/>tsc --noEmit"]
    G --> G2["âœ… Lint / Format<br/>Biome"]
    G --> G3["âœ… å•å…ƒæµ‹è¯•<br/>Vitest"]
    G --> G4["âœ… E2E æµ‹è¯•<br/>Playwright"]

    E --> H["ğŸŒ ç”Ÿäº§ç¯å¢ƒ"]
    H --> H1["Vercel CDN"]
    H --> H2["Neon PostgreSQL"]
    H --> H3["Upstash Redis"]

    style E fill:#22c55e,stroke:#16a34a,color:#fff
    style F fill:#f59e0b,stroke:#d97706,color:#fff
</pre>
</div>

<!-- ==================== 7. å®ç°è·¯çº¿å›¾ ==================== -->
<h2 id="impl-gantt"><span>7</span>å®ç°è·¯çº¿å›¾ (Gantt)</h2>
<div class="diagram-card">
<pre class="mermaid">
gantt
    title Portal å®ç°è·¯çº¿å›¾ (MVP ä¼˜å…ˆ)
    dateFormat  YYYY-MM-DD
    axisFormat  %m/%d

    section Phase 0 åŸºç¡€è®¾æ–½
    Monorepo + å·¥å…·é“¾ + Docker    :p0, 2026-02-17, 3d

    section Phase 1 æ ¸å¿ƒç³»ç»Ÿ
    ä¸»é¢˜å¼•æ“                      :p1a, after p0, 4d
    å¸ƒå±€ç³»ç»Ÿä¸å¯¼èˆª                :p1b, after p1a, 3d
    é…ç½®ç³»ç»Ÿä¸æ¨¡å—åŠ è½½å™¨          :p1c, after p1b, 3d

    section Phase 2 MVP æœ€å°ç³»ç»Ÿ
    æ•°æ®åº“ Prisma + tRPC API å±‚   :p2a, after p1c, 4d
    About å…³äºæˆ‘æ¨¡å—              :p2b, after p2a, 2d
    Blog åšå®¢æ¨¡å—                 :p2c, after p2b, 5d
    Guestbook ç•™è¨€æ¿              :p2d, after p2c, 3d

    section Phase 3 å†…å®¹å¢å¼º
    Search å…¨ç«™æœç´¢               :p3a, after p2d, 3d
    è®¤è¯ä¸æƒé™ç³»ç»Ÿ                :p3b, after p3a, 3d
    ç®¡ç†åå° (ä»ªè¡¨ç›˜+å†…å®¹ç®¡ç†)    :p3c, after p3b, 7d

    section Phase 4 å±•ç¤ºæ¨¡å—
    Portfolio ä½œå“é›†              :p4a, after p3c, 4d
    Analytics æ•°æ®ç»Ÿè®¡            :p4b, after p4a, 3d
    ç®¡ç†åå° (å¤–è§‚+æ¨¡å—ç®¡ç†)      :p4c, after p4b, 3d

    section Phase 5 æ‰©å±•æ¨¡å—
    Resume ç®€å†                   :p5a, after p4c, 3d
    Gallery å›¾åº“                  :p5b, after p5a, 4d
    Links å‹é“¾                    :p5c, after p5b, 2d
    Tools å·¥å…·ç®±                  :p5d, after p5c, 3d

    section Phase 6 ä¼˜åŒ–ä¸ä¸Šçº¿
    SEO / i18n / æ€§èƒ½ä¼˜åŒ–         :p6a, after p5d, 3d
    CI/CD + ç”Ÿäº§éƒ¨ç½²              :p6b, after p6a, 3d
</pre>
</div>
<p class="note">MVP ä¼˜å…ˆç­–ç•¥ï¼šPhase 0-2 å¿«é€Ÿæ­èµ·å¯è¿è¡Œç³»ç»Ÿï¼ˆDBâ†’APIâ†’å‰ç«¯ï¼‰ï¼Œä¹‹åè¿­ä»£å¢å¼ºã€‚</p>

<script>
  mermaid.initialize({
    startOnLoad: true,
    theme: 'dark',
    themeVariables: {
      primaryColor: '#6366f1',
      primaryTextColor: '#e2e8f0',
      lineColor: '#6366f1',
      secondaryColor: '#1e293b',
      tertiaryColor: '#1e293b',
    },
    flowchart: { curve: 'basis', padding: 20 },
    er: { fontSize: 12 },
    gantt: {
      fontSize: 12,
      barHeight: 24,
      barGap: 6,
    }
  });
</script>

</body>
</html>
